<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Valuation Dashboard - BMP | DCF Model</title>
  <meta name="description"
    content="Interactive DCF Valuation Model for CTCP Nhựa Bình Minh (BMP) with Monte Carlo simulation, sensitivity analysis, and financial health scoring.">
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
    rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Data Inputs -->
  <script src="data/financials.js"></script>
  <!-- Financial Ratios Engine -->
  <script src="js/financial-ratios.js"></script>
  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <!-- Header -->
  <header>
    <div class="header-container">
      <div class="brand">
        <span>VIETCHUONG.</span>
        <span style="font-weight:400; color:var(--text-sub); margin-left: 0.75rem; font-size: 0.85rem;">CTCP Nhựa Bình
          Minh
          (BMP)</span>
      </div>

      <div style="display: flex; gap: 2rem;">
        <nav>
          <a href="index.html" class="nav-link active">Valuation Model</a>
          <a href="inputs.html" class="nav-link">Historical Data</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- Main Dashboard -->
  <main class="main-content">

    <!-- Analysis Tab Navigation -->
    <div class="analysis-tabs-wrapper">
      <div class="analysis-tabs" id="analysis-tabs">
        <div class="analysis-tab-slider" id="analysis-tab-slider"></div>
        <button class="analysis-tab active" data-tab="valuation" onclick="switchAnalysisTab('valuation')">
          Valuation Model
        </button>
        <button class="analysis-tab" data-tab="analysis" onclick="switchAnalysisTab('analysis')">
          Financial Analysis
        </button>
        <button class="analysis-tab" data-tab="health" onclick="switchAnalysisTab('health')">
          Health Score
        </button>
      </div>
    </div>

    <!-- ===================== TAB 1: VALUATION ===================== -->
    <div id="tab-valuation" class="tab-panel active-panel">

      <!-- Model Assumptions Card -->
      <section class="card assumptions-card">
        <div class="card-header">
          <span>Model Assumptions & Scenarios</span>
          <div class="scenario-btns">
            <button class="scenario-btn" onclick="setScenario('bear')">Bear</button>
            <button class="scenario-btn active" onclick="setScenario('base')">Base</button>
            <button class="scenario-btn" onclick="setScenario('bull')">Bull</button>
          </div>
        </div>

        <div class="assumptions-grid">
          <div class="input-group">
            <label>
              <span class="label-text">
                Revenue Growth
                <span class="input-tooltip">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">Tốc độ tăng trưởng doanh thu hàng năm</span>
                </span>
              </span>
              <span class="val" id="val-growth">5.0%</span>
            </label>
            <input type="range" id="growth" min="-10" max="20" step="0.5" value="5">
          </div>

          <div class="input-group">
            <label>
              <span class="label-text">
                EBITDA Margin
                <span class="input-tooltip">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">Biên lợi nhuận EBITDA trên doanh thu</span>
                </span>
              </span>
              <span class="val" id="val-margin">24.0%</span>
            </label>
            <input type="range" id="margin" min="10" max="40" step="0.5" value="24">
          </div>

          <div class="input-group">
            <label>
              <span class="label-text">
                WACC
                <span class="input-tooltip">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">Chi phí sử dụng vốn bình quân gia quyền</span>
                </span>
              </span>
              <span class="val" id="val-wacc">12.0%</span>
            </label>
            <input type="range" id="wacc" min="5" max="20" step="0.1" value="12">
          </div>

          <div class="input-group">
            <label>
              <span class="label-text">
                Terminal Growth
                <span class="input-tooltip">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">Tỷ lệ tăng trưởng vĩnh viễn sau giai đoạn dự phóng</span>
                </span>
              </span>
              <span class="val" id="val-term">2.0%</span>
            </label>
            <input type="range" id="terminal" min="0" max="5" step="0.1" value="2">
          </div>

          <div class="input-group">
            <label>
              <span class="label-text">
                Tax Rate
                <span class="input-tooltip">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">Thuế suất thuế thu nhập doanh nghiệp</span>
                </span>
              </span>
              <span class="val" id="val-tax">20.0%</span>
            </label>
            <input type="range" id="tax" min="0" max="30" step="1" value="20">
          </div>
        </div>
      </section>
      <!-- Hero Metrics -->
      <section class="valuation-hero">
        <div class="hero-metric primary">
          <div class="hero-label">Implied Share Price</div>
          <div class="hero-value" id="share-price">---</div>
          <div class="hero-sub" id="upside">---</div>
        </div>
        <div class="hero-metric">
          <div class="hero-label">Enterprise Value</div>
          <div class="hero-value" id="ev-value">---</div>
          <div class="hero-sub">Bn VND</div>
        </div>
        <div class="hero-metric">
          <div class="hero-label">Equity Value</div>
          <div class="hero-value" id="equity-value">---</div>
          <div class="hero-sub">Bn VND</div>
        </div>
      </section>

      <!-- Charts Row 1 -->
      <div class="grid-2">
        <section class="card">
          <div class="card-header">DCF Projections (5Y)</div>
          <div style="position: relative; height: 300px;">
            <canvas id="dcfChart"></canvas>
          </div>
        </section>
        <section class="card">
          <div class="card-header">Monte Carlo Simulation (1000 Iterations)</div>
          <div style="position: relative; height: 300px;">
            <canvas id="monteCarloChart"></canvas>
          </div>
          <div
            style="margin-top: 10px; font-size: 0.8rem; display: flex; justify-content: space-between; color: var(--text-sub);">
            <span>Min: <span id="mc-min" class="num-cell" style="color: var(--danger);">---</span></span>
            <span>Mean: <span id="mc-mean" class="num-cell" style="color: var(--accent);">---</span></span>
            <span>Max: <span id="mc-max" class="num-cell" style="color: var(--success);">---</span></span>
          </div>
        </section>
      </div>

      <!-- Analysis Row 2 -->
      <div class="grid-2">
        <section class="card">
          <div class="card-header">Sensitivity Analysis (Price in VND)</div>
          <div id="sensitivity-heatmap" class="heatmap"></div>
          <div style="margin-top: 10px; text-align: center; font-size: 0.78rem; color: var(--text-dim);">
            Rows: WACC (%) &nbsp;|&nbsp; Cols: Terminal Growth (%) &nbsp;·&nbsp;
            <span style="color: var(--accent);">■</span> Base Case
          </div>
        </section>
        <section class="card">
          <div class="card-header">Financial Forecast (Bn VND)</div>
          <table class="data-table" id="forecast-table">
            <thead>
              <tr>
                <th>Year</th>
                <th>Revenue</th>
                <th>EBITDA</th>
                <th>FCF</th>
              </tr>
            </thead>
            <tbody><!-- JS --></tbody>
          </table>
        </section>
      </div>

      <!-- Valuation Summary Box -->
      <section class="valuation-summary">
        <div class="card-header">Valuation Summary</div>
        <div class="summary-grid">
          <div class="summary-item">
            <span class="summary-label">PV of FCFs</span>
            <span class="summary-value" id="sum-pv-fcf">---</span>
            <span class="summary-note">Discounted cash flows (5Y)</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">PV of Terminal Value</span>
            <span class="summary-value" id="sum-pv-tv">---</span>
            <span class="summary-note">Gordon growth model</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Enterprise Value</span>
            <span class="summary-value" id="sum-ev">---</span>
            <span class="summary-note">PV(FCF) + PV(TV)</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Net Cash / (Debt)</span>
            <span class="summary-value" id="sum-net-cash">---</span>
            <span class="summary-note">Cash − Total Debt</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Equity Value</span>
            <span class="summary-value" id="sum-equity">---</span>
            <span class="summary-note">EV + Cash − Debt</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Shares Outstanding</span>
            <span class="summary-value" id="sum-shares">---</span>
            <span class="summary-note">Million shares</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Implied Price / Share</span>
            <span class="summary-value" id="sum-price" style="color: var(--accent);">---</span>
            <span class="summary-note">Equity ÷ Shares</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Monte Carlo Mean</span>
            <span class="summary-value" id="sum-mc-mean" style="color: var(--success);">---</span>
            <span class="summary-note">1,000 iterations avg</span>
          </div>
        </div>
      </section>
    </div>

    <!-- ===================== TAB 2: FINANCIAL ANALYSIS ===================== -->
    <div id="tab-analysis" class="tab-panel">

      <!-- Key Ratio Cards -->
      <section class="ratio-cards-grid" id="ratio-cards">
        <!-- Injected by JS -->
      </section>

      <!-- Profitability Trend + Balance Sheet Ratios -->
      <div class="grid-2">
        <section class="card">
          <div class="card-header">Profitability Trend (5Y)</div>
          <div style="position: relative; height: 300px;">
            <canvas id="profitTrendChart"></canvas>
          </div>
        </section>
        <section class="card">
          <div class="card-header">Balance Sheet Ratios (5Y)</div>
          <div style="position: relative; height: 300px;">
            <canvas id="bsRatiosChart"></canvas>
          </div>
        </section>
      </div>

      <!-- DuPont Analysis -->
      <section class="card dupont-section">
        <div class="card-header">DuPont Analysis — ROE Decomposition (2025)</div>
        <div class="dupont-flow" id="dupont-flow">
          <!-- Injected by JS -->
        </div>
      </section>

      <!-- Ratio Details Table -->
      <section class="card">
        <div class="card-header">All Financial Ratios — Detailed View</div>
        <div style="overflow-x: auto;">
          <table class="data-table" id="ratio-detail-table">
            <thead>
              <tr>
                <th style="text-align:left">Ratio</th>
                <th>2021</th>
                <th>2022</th>
                <th>2023</th>
                <th>2024</th>
                <th>2025</th>
                <th>Rating</th>
              </tr>
            </thead>
            <tbody><!-- JS --></tbody>
          </table>
        </div>
      </section>

    </div>

    <!-- ===================== TAB 3: HEALTH SCORE ===================== -->
    <div id="tab-health" class="tab-panel">

      <!-- Health Score Hero -->
      <section class="health-hero" id="health-hero">
        <!-- Injected by JS -->
      </section>

      <!-- Radar Chart + Category Breakdown -->
      <div class="grid-2">
        <section class="card">
          <div class="card-header">Financial Health Radar</div>
          <div style="position: relative; height: 320px;">
            <canvas id="radarChart"></canvas>
          </div>
        </section>
        <section class="card">
          <div class="card-header">Category Scores</div>
          <div id="category-scores">
            <!-- Injected by JS -->
          </div>
        </section>
      </div>

      <!-- AI Interpretation Panel -->
      <section class="interpretation-panel" id="interpretation-panel">
        <div class="card-header">
          <span>AI Financial Insights</span>
          <span class="interp-badge">Auto-Generated</span>
        </div>
        <div class="interpretation-content" id="interpretation-content">
          <!-- Injected by JS -->
        </div>
      </section>

    </div>

  </main>

  <!-- Footer -->
  <footer class="page-footer">
    <div class="footer-container">
      <div>
        Nguồn dữ liệu: Báo cáo tài chính kiểm toán CTCP Nhựa Bình Minh (HoSE: BMP) — Đơn vị: Tỷ VND
      </div>
      <div style="margin-top: 0.4rem;">
        Built by <a href="#">VIETCHUONG</a>
        <span class="footer-divider">|</span>
        Disclaimer: Dữ liệu chỉ mang tính chất tham khảo, không phải khuyến nghị đầu tư.
      </div>
    </div>
  </footer>

  <!-- Logic -->
  <script src="js/app.js"></script>
</body>

</html>